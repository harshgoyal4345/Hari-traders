<!DOCTYPE html>
<html>
<head>
    <title>Customer Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">

    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #f0f2f5;
            padding-bottom: 80px;
            color: #1c1e21;
        }

        /* Top Bar */
        .topbar {
            height: 60px;
            background: #1a237e;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        /* Search Bar */
        .search-area {
            padding: 12px;
            display: flex;
            gap: 10px;
            background: white;
            border-bottom: 1px solid #ddd;
        }

        .search-area input {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            border: 2px solid #ced4da;
            outline: none;
        }

        /* Product Card */
        .product {
            background: #fff;
            margin: 12px;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.05);
        }

        .product-title {
            font-size: 19px;
            margin-bottom: 12px;
            font-weight: 800;
            color: #1a237e;
        }

        /* Variant Carousel */
        .variant-row {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 5px 0;
            -webkit-overflow-scrolling: touch;
        }

        .variant-row::-webkit-scrollbar { display: none; }

        .variant-card {
            min-width: 140px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .variant-card img {
            width: 110px;
            height: 110px;
            object-fit: cover;
            border-radius: 8px;
            background: #eee;
            margin-bottom: 8px;
        }

        .variant-name {
            font-size: 15px;
            font-weight: 700;
            color: #333;
            min-height: 40px;
            margin-bottom: 5px;
        }

        .variant-price {
            color: #2e7d32;
            font-weight: 800;
            font-size: 17px;
        }

        .qty-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
        }

        .qty-controls button {
            width: 35px;
            height: 35px;
            border: none;
            background: #1a237e;
            color: #fff;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
        }

        .bottom-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #1a237e;
            color: #fff;
            padding: 20px;
            text-align: center;
            font-size: 18px;
            cursor: pointer;
            box-sizing: border-box;
            font-weight: 800;
            z-index: 99;
        }

        /* Modal Settings */
        #cartModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            margin: 10% auto;
            width: 90%;
            border-radius: 15px;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #eee;
            padding-bottom: 12px;
            margin-bottom: 15px;
        }

        .product-group {
            margin-bottom: 15px;
            border: 2px solid #f0f2f5;
            padding: 12px;
            border-radius: 10px;
        }

        .product-group-title { font-weight: 800; color: #1a237e; font-size: 16px; margin-bottom: 5px; }

        .variant-item { display: flex; justify-content: space-between; font-size: 15px; padding: 4px 0; color: #444; }

        .group-total { text-align: right; font-weight: 700; border-top: 1px dashed #ddd; margin-top: 5px; padding-top: 5px; color: #1a237e; }

        #finalTotal { text-align: right; font-size: 22px; font-weight: 900; margin: 20px 0; color: #2e7d32; }

        /* Checkout Button */
        .checkout-btn {
            display: block;
            width: 100%;
            padding: 18px;
            background: #25d366;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            font-size: 18px;
            text-align: center;
            cursor: pointer;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <div class="topbar">
        <div id="shopName">HARI TRADERS</div>
    </div>

    <div class="search-area">
        <input type="text" id="searchInput" placeholder="Search products..." oninput="renderProducts()">
    </div>

    <div id="productList"></div>

    <div class="bottom-bar" id="viewCartBtn" onclick="openCart()">
        View Cart: ₹0
    </div>

    <div id="cartModal">
        <div class="modal-content">
            <div class="cart-header">
                <span style="font-weight:900; font-size:20px; color:#1a237e;">Review Order</span>
                <span onclick="closeCart()" style="cursor:pointer; color:#dc3545; font-weight:900; font-size:24px;">✕</span>
            </div>
            <div id="cartContent"></div>
            <div id="finalTotal"></div>
            
            <button class="checkout-btn" onclick="checkoutNow()">
                SEND TO WHATSAPP
            </button>
        </div>
    </div>

    <script>
        const WHATSAPP_NUMBER = "917415768041"; 

        const products = [
            {
                id: 1,
                name: "Yellow Diamond",
                variants: [
                    { vid: 1, label: "Aloo Bhujia", stock: 30, price: 50, image: "https://via.placeholder.com/150?text=Aloo+Bhujia" },
                    { vid: 2, label: "Ratlami", stock: 100, price: 50, image: "https://via.placeholder.com/150?text=Ratlami" },
                    { vid: 3, label: "Moong Dal", stock: 4, price: 5, image: "https://via.placeholder.com/150?text=Moong+Dal" }
                ]
            },
            {
                id: 2,
                name: "Shree Hari",
                variants: [
                    { vid: 4, label: "Ponga", stock: 10, price: 50, image: "https://via.placeholder.com/150?text=Ponga" },
                    { vid: 5, label: "Jali", stock: 10, price: 50, image: "https://via.placeholder.com/150?text=Jali" },
                ]
            }
        ];

        let cart = {}; 

        function renderProducts() {
            const query = document.getElementById("searchInput").value.toLowerCase();
            let html = "";

            products.forEach(p => {
                const matchesMain = p.name.toLowerCase().includes(query);
                const matchingVariants = p.variants.filter(v => v.label.toLowerCase().includes(query));

                if (matchesMain || matchingVariants.length > 0) {
                    html += `<div class="product"><div class="product-title">${p.name}</div><div class="variant-row">`;
                    p.variants.forEach(v => {
                        if (query && !matchesMain && !v.label.toLowerCase().includes(query)) return;
                        const key = p.id + "_" + v.vid;
                        const qty = cart[key] || 0;
                        html += `
                            <div class="variant-card">
                                <img src="${v.image}" onerror="this.src='https://via.placeholder.com/150?text=Snack'">
                                <div class="variant-name">${v.label}</div>
                                <div class="variant-price">₹${v.price}</div>
                                <div class="qty-controls">
                                    <button onclick="updateQty(${p.id}, ${v.vid}, -1)">-</button>
                                    <span id="qty_${key}">${qty}</span>
                                    <button onclick="updateQty(${p.id}, ${v.vid}, 1)">+</button>
                                </div>
                            </div>`;
                    });
                    html += `</div></div>`;
                }
            });
            document.getElementById("productList").innerHTML = html || `<p style="text-align:center; padding:50px;">No snacks found.</p>`;
        }

        function updateQty(pid, vid, delta) {
            const key = pid + "_" + vid;
            let current = cart[key] || 0;
            let newVal = current + delta;
            if (newVal < 0) newVal = 0;
            
            const variant = products.find(x => x.id === pid).variants.find(x => x.vid === vid);
            if (newVal > variant.stock) newVal = variant.stock;

            if (newVal === 0) delete cart[key];
            else cart[key] = newVal;

            if(document.getElementById("qty_" + key)) document.getElementById("qty_" + key).innerText = newVal;
            calculateTotal();
        }

        function calculateTotal() {
            let total = 0;
            for (let key in cart) {
                const [pid, vid] = key.split("_").map(Number);
                const v = products.find(p => p.id === pid).variants.find(v => v.vid === vid);
                total += (cart[key] * v.price);
            }
            document.getElementById("viewCartBtn").innerText = `View Cart: ₹${total}`;
        }

        function openCart() {
            const content = document.getElementById("cartContent");
            let html = "";
            let grandTotal = 0;

            const grouped = {};
            for (let key in cart) {
                const [pid, vid] = key.split("_").map(Number);
                if (!grouped[pid]) grouped[pid] = [];
                grouped[pid].push({ vid, qty: cart[key] });
            }

            const pids = Object.keys(grouped);
            if (pids.length === 0) {
                html = "<p style='text-align:center; padding:30px; font-weight:bold;'>Empty Cart</p>";
            } else {
                pids.forEach(pid => {
                    const product = products.find(p => p.id == pid);
                    let sub = 0;
                    html += `<div class="product-group"><div class="product-group-title">${product.name}</div>`;
                    grouped[pid].forEach(item => {
                        const variant = product.variants.find(v => v.vid == item.vid);
                        const line = item.qty * variant.price;
                        sub += line;
                        grandTotal += line;
                        html += `<div class="variant-item"><span>${variant.label} x ${item.qty}</span><span>₹${line}</span></div>`;
                    });
                    html += `<div class="group-total">Subtotal: ₹${sub}</div></div>`;
                });
            }

            content.innerHTML = html;
            document.getElementById("finalTotal").innerText = grandTotal > 0 ? "TOTAL: ₹" + grandTotal : "";
            document.getElementById("cartModal").style.display = "block";
        }

        function closeCart() { document.getElementById("cartModal").style.display = "none"; }

        function checkoutNow() {
            let msg = `NEW ORDER: HARI TRADERS\n--------------------\n`;
            let total = 0;

            const grouped = {};
            for (let key in cart) {
                const [pid, vid] = key.split("_").map(Number);
                if (!grouped[pid]) grouped[pid] = [];
                grouped[pid].push({ vid, qty: cart[key] });
            }

            for (let pid in grouped) {
                const product = products.find(p => p.id == pid);
                msg += `\n${product.name.toUpperCase()}\n`;
                grouped[pid].forEach(item => {
                    const variant = product.variants.find(v => v.vid == item.vid);
                    const line = item.qty * variant.price;
                    total += line;
                    msg += `- ${variant.label}: ${item.qty} = ₹${line}\n`;
                });
            }

            if (total === 0) return;
            msg += `\n--------------------\nTOTAL: ₹${total}`;

            // NATIVE SHARE FALLBACK (Modern Mobile Browsers)
            if (navigator.share) {
                navigator.share({ text: msg }).catch(() => openWhatsAppDirect(msg));
            } else {
                openWhatsAppDirect(msg);
            }
        }

        function openWhatsAppDirect(msg) {
            // Using a simple window location instead of a link helps with encoding
            const url = `https://wa.me/${WHATSAPP_NUMBER}?text=` + encodeURIComponent(msg);
            window.location.href = url;
        }

        renderProducts();
    </script>
</body>
</html>

		